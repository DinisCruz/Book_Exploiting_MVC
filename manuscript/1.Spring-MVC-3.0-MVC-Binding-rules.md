## Spring MVC 3.0 MVC Binding rules
  
Following the work done on the [O2 Cmd - Spring MVC](http://deploy.o2-ounceopen.com/O2_Cmd_SpringMvc/) module and the conversations we had at OWASP AppSec Ireland about the security implications of the Spring Framework MVC, I spent some time today looking at what is happening at its next major release (3.0.x)

From the MVC documentation section _15.3.2.3 Supported handler method arguments and return types section in Spring 3.0_ (see [15.3 Implementing Controllers](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/ch15s03.html) ) we can see (included at the end of this post) the Spring MVC rules to:

a) map web data into controllers and

b) send data from controllers to the views. 

  


There are quite a number of new features/capabilities, and most have security implications!  


  
For reference, here are a number of good articles & Blog Posts on Spring MVC 3.0

  * [Spring Finance > Part 2: Spring @MVC & Spring 3.0 REST integration ](http://stsmedia.net/spring-finance-part-2-spring-mvc-spring-30-rest-integration/)
  * [New stuff in Spring 3.0](http://springinpractice.com/tag/spring-web-mvc/) & [New stuff in Spring 3.0, part 2](http://springinpractice.com/2008/12/03/new-stuff-in-spring-30-part-2/)
  * [REST in Spring 3: @MVC ](http://blog.springsource.com/2009/03/08/rest-in-spring-3-mvc/)
  * [Spring 3 MVC CodeMash 2009](http://www.slideshare.net/kensipe/spring-mvc-code-mash09-presentation)
  * Spring 3.0 docs: [2.5 Overview of new features](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/ch02s05.html) , [15.3 Implementing Controllers](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/ch15s03.html)
  * [GWT, Spring 3.0 MVC, and REST on Google App Engine / Java - Part 1](http://bigohno.blogspot.com/2009/04/gwt-spring-mvc-and-rest-on-google-app.html) & [GWT, Spring 3.0 MVC, and REST on Google App Engine / Java - Part 2](http://bigohno.blogspot.com/2009/04/gwt-spring-30-mvc-and-rest-on-google.html)

I find a bit worrying that the security implications of the way Spring MVC works (for both old and new features) is NOT properly documented in these articles (for example making references to [Security implications of the Spring DataBinder](http://www.celerity.nl/blog/2008/04/security-implications-of-the-spring-databinder/) (note-to-self: create page with my & others past research on this topic))

  


The list below (from [15.3 Implementing Controllers](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/ch15s03.html)) is what we need to add to the next version of [O2 Cmd - Spring MVC](http://deploy.o2-ounceopen.com/O2_Cmd_SpringMvc/) module so that it supports Spring MVC 3.0 (in fact I need to dig out the docs about Spring MVC 2.5 works, and start there :) )

  


#### _15.3.2.3 Supported handler method arguments and return types_

_Handler methods that are annotated with _`_@RequestMapping_`_ can have very flexible signatures. They may have arguments of the following types, in arbitrary order. (except for validation results, which need to follow right after the corresponding command object, if desired):_

  * _Request and/or response objects (Servlet API). Choose any specific request/response type, for example, _`_ServletRequest_`_ / _`_HttpServletRequest_`_._

  * _Session object (Servlet API): of type _`_HttpSession_`_. An argument of this type enforces the presence of a corresponding session. As a consequence, such an argument is never _`_null_`_._

  * `_org.springframework.web.context.request.WebRequest_`_ or _`_org.springframework.web.context.request.NativeWebRequest_`_. Allows for generic request parameter access as well as request/session attribute access, without ties to the native Servlet/Portlet API._

  * `_java.util.Locale_`_ for the current request locale, determined by the most specific locale resolver available, in effect, the configured _`_LocaleResolver_`_ in a Servlet environment._

  * `_java.io.InputStream_`_ / _`_java.io.Reader_`_ for access to the request's content. This value is the raw InputStream/Reader as exposed by the Servlet API._

  * `_java.io.OutputStream_`_ / _`_java.io.Writer_`_ for generating the response's content. This value is the raw OutputStream/Writer as exposed by the Servlet API._

  * `_@PathVariabe_`_ annotated parameters for access to URI template variables. See _[_Section 15.3.2.1, "URI Templates"_](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/ch15s03.html#mvc-ann-requestmapping-uri-templates)_._

  * `_@RequestParam_`_ annotated parameters for access to specific Servlet request parameters. Parameter values are converted to the declared method argument type. See _[_Section 15.3.2.4, "Binding request parameters to method parameters with @RequestParam"_](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/ch15s03.html#mvc-ann-requestparam)_._

  * `_@RequestHeader_`_ annotated parameters for access to specific Servlet request HTTP headers. Parameter values are converted to the declared method argument type._

  * `_@RequestBody_`_ annotated parameters for access to the request HTTP body. Parameter values are converted to the declared method argument type using _`_HttpMessageConverter_`_s. See _[_Section 15.3.2.5, "Mapping the request body with the @RequestBody annotation"_](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/ch15s03.html#mvc-ann-requestbody)_._

  * `_java.util.Map_`_ / _`_org.springframework.ui.Model_`_ / _`_org.springframework.ui.ModelMap_`_ for enriching the implicit model that is exposed to the web view._

  * _Command or form objects to bind parameters to: as bean properties or fields, with customizable type conversion, depending on _`_@InitBinder_`_ methods and/or the HandlerAdapter configuration. See the_`_webBindingInitializer_`_ property on _`_AnnotationMethodHandlerAdapter_`_. Such command objects along with their validation results will be exposed as model attributes by default., using the non-qualified command class name in property notation. For example, "orderAddress" for type "mypackage.OrderAddress". Specify a parameter-level _`_ModelAttribute_`_ annotation for declaring a specific model attribute name._

  * `_org.springframework.validation.Errors_`_ / _`_org.springframework.validation.BindingResult_`_ validation results for a preceding command or form object (the immediately preceding argument)._

  * `_org.springframework.web.bind.support.SessionStatus_`_ status handle for marking form processing as complete, which triggers the cleanup of session attributes that have been indicated by the_`_@SessionAttributes_`_ annotation at the handler type level._

_The following return types are supported for handler methods:_

  * _A _`_ModelAndView_`_ object, with the model implicitly enriched with command objects and the results of _`_@ModelAttribute_`_ annotated reference data accessor methods._

  * _A _`_Model_`_ object, with the view name implicitly determined through a _`_RequestToViewNameTranslator_`_ and the model implicitly enriched with command objects and the results of _`_@ModelAttribute_`_annotated reference data accessor methods._

  * _A _`_Map_`_ object for exposing a model, with the view name implicitly determined through a _`_RequestToViewNameTranslator_`_ and the model implicitly enriched with command objects and the results of_`_@ModelAttribute_`_ annotated reference data accessor methods._

  * _A _`_View_`_ object, with the model implicitly determined through command objects and _`_@ModelAttribute_`_ annotated reference data accessor methods. The handler method may also programmatically enrich the model by declaring a _`_Model_`_ argument (see above)._

  * _A _`_String_`_ value that is interpreted as the view name, with the model implicitly determined through command objects and _`_@ModelAttribute_`_ annotated reference data accessor methods. The handler method may also programmatically enrich the model by declaring a _`_Model_`_ argument (see above)._

  * `_void_`_ if the method handles the response itself (by writing the response content directly, declaring an argument of type _`_ServletResponse_`_ / _`_HttpServletResponse_`_ for that purpose) or if the view name is supposed to be implicitly determined through a _`_RequestToViewNameTranslator_`_ (not declaring a response argument in the handler method signature)._

  * _If the method is annotated with _`_@ResponseBody_`_, the return type is written to the response HTTP body. The return value will be converted to the declared method argument type using_`_HttpMessageConverter_`_s. See _[_Section 15.3.2.6, "Mapping the response body with the @ResponseBody annotation"_](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/ch15s03.html#mvc-ann-responsebody)_._

  * _Any other return type is considered as single model attribute to be exposed to the view, using the attribute name specified through _`_@ModelAttribute_`_ at the method level (or the default attribute name based on the return type class name). The model is implicitly enriched with command objects and the results of _`_@ModelAttribute_`_ annotated reference data accessor methods._
