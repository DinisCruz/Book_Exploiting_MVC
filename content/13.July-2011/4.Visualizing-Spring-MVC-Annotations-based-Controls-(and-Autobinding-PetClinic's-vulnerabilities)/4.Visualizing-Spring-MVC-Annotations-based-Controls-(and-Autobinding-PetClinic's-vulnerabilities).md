## Visualizing Spring MVC Annotations based Controls (and Autobinding PetClinic's vulnerabilities)

If you are reviewing a Spring MVC aplication that uses Java Annotations to define the controller's behaviour, you can use an older version of O2 (packaged separately) which was published a couple years ago, but is still quite effective in its capabilities. You can get the installer [from here ](http://s3.amazonaws.com/O2_Downloads/O2_Cmd_SpringMvc.msi)or just execute the following script to download it and start the installation process:

**TODO: FIX CODE BELOW**

{lang="csharp"}
[sourcecode language="csharp" wraplines="false"] var path = &quot;http://s3.amazonaws.com/O2_Downloads/O2_Cmd_SpringMvc.msi&quot;.uri().download(); path.startProcess(); [/sourcecode]

Once it is installed, you will have a shortcut on your desktop called **_O2_Cmd_SpringMvc.exe_** which when executed looks like this:

![](images/tmp11e4-tmp.jpeg)

For the rest of this demo I'm going to use the PetClinc Spring MVC demo app, which you can download from SpringSource or from the O2 Demo Pack that I  published (see [Packaged Spring MVC Security Test Apps: JPetStore and PetClinic](http://o2platform.wordpress.com/2011/07/18/packaged-spring-mvc-security-test-apps-jpetstore-and-petclinc/)) Unzip the files to the **C:\O2\Demos** folder

![](images/tmp10e6-tmp.jpeg)

And drag and drop the petclinic.classes.zip file into the big red box (top left) from the O2 Spring MVC module, which will trigger the conversion process:

![](images/tmpd0b8-tmp.jpeg)

Once the coversion is finished, you will see the Spring MVC mappings and its source code location:

![](images/tmpb79e-tmp.jpeg)

If you select a URL that uses @ModelAttribure, and go to the _**Spring MVC Bindable fields for selection**_  tab, you will see a graphical representation of the fields that can be binded into (and that create another variation of the Spring Framework Autobinding vulnerabilities)

![](images/tmp33cb-tmp.jpeg)

Note that in order for the o2 engine to find some of these mappings, there are a couple cases where an extra comment needs to be added to the affected classes. For example, in the Owner.java class:

**TODO: FIX CODE BELOW**

{lang="csharp"}
[sourcecode language="csharp" wraplines="false"]     public List&lt;Pet&gt; getPets() {      /*O2Helper:MVCAutoBindListObject:org.springframework.samples.petclinic.Pet*/ [/sourcecode]

This O2 tool also has a BlackBox analysis module, which allow the use of the mappings created to drive/test the website dynamically

![](images/tmp328-tmp.jpeg)

For example here is how to bypass the current SetDisallowedFields protection that is included in the controller for /editOwner.do

**TODO: FIX CODE BELOW**

{lang="csharp"}
[sourcecode language="csharp" wraplines="false"]     @InitBinder     public void setAllowedFields(WebDataBinder dataBinder) {         dataBinder.setDisallowedFields(new String[] {&quot;id&quot;});     } [/sourcecode]

Note the extra field _**pets[0].owner.id=6**_ which save the current data into user #6   

![](images/tmp586f-tmp.jpeg)   

This app (together with JPetStore) presents good case-studies on the security vulnerabilities that are easily created with the Spring Autobinding capabilities. In the above example, the Edit Owner page should only allow 5 fields to be edited, while in fact it allows a VERY large number of fields to be edited

![](images/tmp37be-tmp.jpeg)

In fact, in this case, there are infinite posibilites, since: _**the Owner class has a getPets method, which returns a Pets class, who has a getOwner method, who has a getPets method , etc....**_

This applicaition also has a large number of XSS vulnerabilities, including the ability to create a Pet with a XSS payload which (via autobinding) can be assigned to another user (i.e. via modifing the pet's owner ID)
